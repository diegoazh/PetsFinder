CREATE OR REPLACE PACKAGE BODY ADOPCIONES AS

PROCEDURE ADOPTAR(IDMASCOTA IN NUMBER, USERNAME IN VARCHAR2,NOMIMAGEN IN VARCHAR) AS
  v_blob blob;
  v_bfile bfile;
  IDUSUARIO NUMBER;
  BEGIN
    SELECT U.ID_USUARIO INTO IDUSUARIO
    FROM USUARIO U
    WHERE U.USER_NAME = USERNAME;
    
    INSERT INTO IMAGEN_ADOPCION(ID_IMAGEN_ADOPCION, NOMBRE_IMG_ADOP)
    VALUES(S_ADOPCION.NEXTVAL,NOMIMAGEN)returning IMAGEN_MASCOTA  into v_blob;
    v_bfile := BFILENAME('DIRECTORIO', NOMIMAGEN);
            DBMS_LOB.OPEN(v_bfile, DBMS_LOB.lob_readonly);
            DBMS_LOB.LOADFROMFILE(v_blob, v_bfile, DBMS_LOB.getlength(v_bfile));
            DBMS_LOB.CLOSE(v_bfile);
    commit;
  
    INSERT INTO ADOPCION(ID_ADOPCION, ID_MASCOTA, ID_PERSONA)
    VALUES(S_ADOPCION.CURRVAL,IDMASCOTA, IDUSUARIO);
    COMMIT;
 end ADOPTAR;

END ADOPCIONES;
